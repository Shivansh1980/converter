{%extends 'basic.html'%}
{%load static%}
{%block style%}
    <link rel="stylesheet" href="{%static 'css/encryptfiles.css'%}">
{%endblock%}
{%block main%}
<div class="containers">
    <div class="encryption">
        <form id="encryption-form" method="POST" enctype="multipart/form-data" novalidate="">
            {%csrf_token%}
            <h1 align="center">Encrypt Your File</h1>
            <div style="margin: 10px; margin-bottom:10px;">
                <label for="" style="font-size: 25px;">Enter Your Email: </label>
                {{form.useremail}}
            </div>

            {{form.file}}
            <!-- <input id="submit" name="submit" type="submit" value="Encrypt"> -->
            <input type="submit">
        </form>
        <div class="encryptedFileDownloadContainer">
            <a id="enc-download" href="" download>Download</a>
        </div>
    </div>
    <div class="decryption">
        <form id="decryption-form" method="POST" enctype="multipart/form-data" novalidate="">
            {%csrf_token%}
            <h1 align="center">Decrypt Your File</h1>
            <div>
                <label for="" style="font-size: 25px;">Enter Your Email: </label>
                {{decryption_form.useremail}}
            </div>
            <div style="margin: 10px; margin-bottom:10px;">
                <label for="" style="font-size: 25px;">Enter Your Key: </label>
                {{decryption_form.key}}
            </div>
            {{decryption_form.file}}
            <!-- <input id="submit" name="submit" type="submit" value="Encrypt"> -->
            <input type="submit">
        </form>
        <div class="decryptedFileDownloadContainer">
            <a id="dec-download" href="" download>Download</a>
        </div>
    </div>
</div>
{%endblock%}
{%block javascript%}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    $('#encryption-form').submit(function (e) {
        e.preventDefault()
        $form = $(this)
        var formData = new FormData(this);
        for (var f of formData){
            console.log(f);
        }
        console.log(formData);
        $.ajax({
            url: "{%url 'encryptfile'%}",
            data: formData,
            type: 'POST',
            success: function (response) {
                if (response.error) {
                    alert(response.error);
                }
                else {
                    $('.encryptedFileDownloadContainer').css("display","block");
                    $("#enc-download").attr("href",response.url);
                    alert(response.msg)
                    alert('Your Key : ' + response.key);
                }
            },
            cache: false,
            contentType: false,
            processData: false
        });
        e.preventDefault()
    });

    $('#decryption-form').submit(function (e) {
        e.preventDefault()
        $form = $(this)
        var formData = new FormData(this);
        for (var f of formData){
            console.log(f);
        }
        console.log(formData);
        $.ajax({
            url: "{%url 'decryptfile'%}",
            data: formData,
            type: 'POST',
            success: function (response) {
                if (response.error) {
                    alert(response.error);
                }
                else {
                    $('.decryptedFileDownloadContainer').css("display","block");
                    $("#dec-download").attr("href",response.url);
                    alert(response.msg);
                }
            },
            cache: false,
            contentType: false,
            processData: false
        });
        e.preventDefault()
    });
</script>
{%endblock%}