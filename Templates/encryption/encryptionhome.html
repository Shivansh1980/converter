{%extends 'basic.html'%}
{%load static%}

{%block main%}
<div class="encryption">
    <form id="ajax-form" method="POST" enctype="multipart/form-data" novalidate="">
        {%csrf_token%}
        <h1 align="center">Encrypt Your File</h1>
        <div style="margin: 10px; margin-bottom:10px;">
            <label for="" style="font-size: 25px;">Enter Your Email: </label>
            {{form.useremail}}
        </div>

        {{form.file}}
        <!-- <input id="submit" name="submit" type="submit" value="Encrypt"> -->
        <input type="submit">
    </form>
    <div class="downloadButtonContainer">
        <a id="enc-download" href="" download>Download</a>
    </div>
</div>
{%endblock%}
{%block javascript%}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    $('#ajax-form').submit(function (e) {
        e.preventDefault()
        $form = $(this)
        var formData = new FormData(this);
        for (var f of formData){
            console.log(f);
        }
        console.log(formData);
        $.ajax({
            url: "{%url 'encryptfile'%}",
            data: formData,
            type: 'POST',
            success: function (response) {
                if (response.error) {
                    alert(response.error);
                }
                else {
                    $('.downloadButtonContainer').css("display","block");
                    $("#enc-download").attr("href",response.url);
                    alert(response.msg);
                }
            },
            cache: false,
            contentType: false,
            processData: false
        });
        e.preventDefault()
    });
</script>
{%endblock%}